# Carbon6 OiS Security Management Guide

**Classification:** L5-BLACK Security Protocol
**Version:** 1.0.0
**Date:** February 12, 2026

---

## ğŸ”’ Security Architecture Overview

The Carbon6 OiS employs **10-Gate Security System** with multiple layers of defense:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    10-GATE SECURITY SYSTEM                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Gate 1:  Installation Verification                             â”‚
â”‚  Gate 2:  Installation Active (Not Suspended)                   â”‚
â”‚  Gate 3:  Ed25519 Signature Validation                          â”‚
â”‚  Gate 4:  Timestamp Window (5 minutes)                          â”‚
â”‚  Gate 5:  Nonce Replay Protection                               â”‚
â”‚  Gate 6:  Body Hash Verification                                â”‚
â”‚  Gate 7:  JWT Token Validation                                  â”‚
â”‚  Gate 8:  Feature Flag Authorization                            â”‚
â”‚  Gate 9:  Rate Limit Enforcement                                â”‚
â”‚  Gate 10: Tier Authorization Check                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–ï¸ Five-Tier Clearance System

### Clearance Hierarchy

| TIER | CLEARANCE | ACCESS LEVEL | WHO |
|------|-----------|--------------|-----|
| **0** | L5-BLACK | Supreme Authority | GENESIS, System Owner |
| **1** | L4-RESTRICTED | Council Core | SOVEREIGN, MNEMOS, AEGIS, PRAXIS, TRUST_DIRECTOR |
| **2** | L3-CONFIDENTIAL | Domain Specialists | AURUM, TECHNE, SOPHIA, MELODIA (24 total) |
| **3** | L2-INTERNAL | Support Agents | CALAMUS, CHRONOS, BENEFACTOR, HERMES, LOGOS |
| **4** | L1-PUBLIC | Interface Agents | SCOUT, FORMA, NUNTIUS, VERBUM |

### Managing Clearance Levels

**View current clearance:**
```bash
# Via Web Terminal
carbon@c6:~$ whoami
User: admin@carbon6.io
Clearance: L5-BLACK
Role: ADMIN
```

**Assign clearance to creators:**
```bash
# Create creator with specific clearance
creator create --email user@example.com --clearance L3-CONFIDENTIAL

# Advance creator tier (auto-adjusts clearance)
creator advance <creator-id> --to-tier CARBON[6]  # L3-CONFIDENTIAL
creator advance <creator-id> --to-tier [6]        # L4-RESTRICTED
```

---

## ğŸ” Credential Management

### Critical Files (NEVER COMMIT)

**Location:** `/Users/Morpheous/Carbon6/platform/`

```bash
.env                    # Contains all secrets
.install-state.json     # Installation metadata
installation.log        # May contain sensitive data
dev.db                  # SQLite database (development)
~/.ssh/id_ed25519       # Private SSH key
~/.ssh/id_ed25519.pub   # Public SSH key
```

**Verify .gitignore protection:**
```bash
cd /Users/Morpheous/Carbon6/platform
cat .gitignore | grep -E "\.env|\.db|\.log|id_ed25519"
```

### Environment Variables (.env)

**Critical secrets managed during installation:**

```bash
# Database Connection
DATABASE_URL="postgresql://localhost/carbon6"

# Security Keys (Auto-generated by Part 1)
JWT_SECRET="<48-byte base64 string>"
ENCRYPTION_KEY="<32-byte base64 string>"
SESSION_SECRET="<48-byte base64 string>"

# Connector Protocol
ED25519_PRIVATE_KEY="<private key path>"
ED25519_PUBLIC_KEY="<public key>"

# Council Integration
COUNCIL_API_KEY="<council authentication key>"
COUNCIL_ENABLED=true

# NVIDIA Integration
NVIDIA_API_KEY="<nvidia api key>"

# Admin Credentials (Set during Part 3)
ADMIN_EMAIL="admin@carbon6.io"
ADMIN_PASSWORD="<strong password>"
```

### Rotating Secrets

**Rotate JWT secret:**
```bash
# Generate new secret
NEW_JWT_SECRET=$(openssl rand -base64 48)

# Update .env
sed -i '' "s|JWT_SECRET=.*|JWT_SECRET=\"$NEW_JWT_SECRET\"|" .env

# Restart services
pm2 restart carbon6-api

# All existing sessions will be invalidated
```

**Rotate encryption key (CAUTION):**
```bash
# This will invalidate encrypted data!
# Only do this if you re-encrypt existing data

NEW_ENCRYPTION_KEY=$(openssl rand -base64 32)
sed -i '' "s|ENCRYPTION_KEY=.*|ENCRYPTION_KEY=\"$NEW_ENCRYPTION_KEY\"|" .env

# Re-encrypt stored data before restarting
npx ts-node scripts/re-encrypt-data.ts --old-key "$OLD_KEY" --new-key "$NEW_KEY"
pm2 restart carbon6-api
```

---

## ğŸ›¡ï¸ Ed25519 + JWT Authentication

### Ed25519 Signature System

**How it works:**
1. SDK generates Ed25519 keypair (or uses provided)
2. Public key registered during SDK installation
3. Every API request signed with private key
4. Server verifies signature using stored public key

**Generate new Ed25519 keypair:**
```bash
# Using OpenSSL
openssl genpkey -algorithm ED25519 -out private.pem
openssl pkey -in private.pem -pubout -out public.pem

# Using ssh-keygen (already done in Part 0)
ssh-keygen -t ed25519 -C "carbon6@connector" -f ~/.ssh/carbon6_connector
```

**Register SDK installation:**
```bash
curl -X POST http://localhost:3006/api/connector/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Partner Integration",
    "platform": "nodejs",
    "public_key": "'"$(cat ~/.ssh/carbon6_connector.pub)"'"
  }'

# Response:
# {
#   "installation_id": "inst_xyz123",
#   "client_id": "cid_abc456",
#   "api_key": "sk_...",
#   "private_key_fingerprint": "SHA256:..."
# }
```

### JWT Token Lifecycle

**Token parameters:**
- **Access Token:** 1 hour expiry
- **Refresh Token:** 7 days expiry
- **Auto-refresh:** When < 5 minutes remaining

**Authorize request (get JWT):**
```bash
# Create signing payload
TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
NONCE=$(openssl rand -base64 32)
BODY_HASH=$(echo -n '{"client_id":"inst_xyz123"}' | openssl dgst -sha3-256 -binary | base64)

# Sign with Ed25519 (pseudo-code - use SDK)
SIGNATURE=$(sign_ed25519 "$PRIVATE_KEY" "$PAYLOAD")

# Authorize
curl -X POST http://localhost:3006/api/connector/authorize \
  -H "X-Client-ID: inst_xyz123" \
  -H "X-Timestamp: $TIMESTAMP" \
  -H "X-Nonce: $NONCE" \
  -H "X-Signature: $SIGNATURE" \
  -d '{"client_id":"inst_xyz123"}'

# Response:
# {
#   "access_token": "eyJhbGc...",
#   "refresh_token": "eyJhbGc...",
#   "expires_in": 3600,
#   "features": {...},
#   "rate_limits": {...}
# }
```

**Revoke tokens (emergency):**
```bash
# Via Web Terminal
sdk suspend <installation-id> --reason "Security breach"

# Or via API
curl -X DELETE http://localhost:3006/api/connector/revoke \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

---

## ğŸ” Audit & Monitoring

### Audit Log System

**LOGOS** (Tier 3 support agent) maintains append-only audit trail.

**View audit logs:**
```bash
# Via Web Terminal
sdk audit <installation-id> --last 24h

# Or query database directly
npx prisma studio
# Navigate to: connector_audit_logs table
```

**Audit log structure:**
```json
{
  "id": 12345,
  "installation_id": "inst_xyz123",
  "action": "invoke",
  "endpoint": "/api/plugins/upload",
  "method": "POST",
  "status_code": 200,
  "signature_valid": true,
  "ip_address": "192.168.1.100",
  "user_agent": "Carbon6-SDK-NodeJS/1.0.0",
  "error_code": null,
  "metadata": {...},
  "created_at": "2026-02-12T10:30:00Z"
}
```

**Alert on suspicious activity:**
```bash
# Create monitoring script
cat > ~/Carbon6/monitor-security.sh << 'EOF'
#!/bin/bash
# Check for failed auth attempts
FAILED=$(psql $DATABASE_URL -t -c "
  SELECT COUNT(*) FROM connector_audit_logs
  WHERE signature_valid = false
  AND created_at > NOW() - INTERVAL '1 hour'
")

if [ "$FAILED" -gt 10 ]; then
  echo "ALERT: $FAILED failed auth attempts in last hour"
  # Send notification
fi
EOF

chmod +x ~/Carbon6/monitor-security.sh

# Add to cron (every 15 minutes)
(crontab -l; echo "*/15 * * * * ~/Carbon6/monitor-security.sh") | crontab -
```

---

## ğŸ”‘ Encryption Standards

### Data at Rest

**Database encryption:**
```sql
-- Sensitive fields encrypted using ENCRYPTION_KEY
CREATE TABLE creators (
  id INTEGER PRIMARY KEY,
  email TEXT NOT NULL,
  password_hash TEXT NOT NULL,  -- bcrypt (12 rounds)
  api_key_encrypted BLOB,        -- AES-256-GCM
  connector_private_key BLOB     -- AES-256-GCM
);
```

**File encryption:**
```bash
# Encrypt sensitive files
openssl enc -aes-256-gcm -salt -in secret.txt -out secret.txt.enc \
  -pass env:ENCRYPTION_KEY

# Decrypt
openssl enc -d -aes-256-gcm -in secret.txt.enc -out secret.txt \
  -pass env:ENCRYPTION_KEY
```

### Data in Transit

**All API connections require TLS 1.3:**
```bash
# Verify TLS version
curl -v https://localhost:3006/api/health 2>&1 | grep "TLS"
# Should show: TLSv1.3
```

**Configure NGINX for production:**
```nginx
server {
    listen 443 ssl http2;
    server_name carbon6.yourdomain.com;

    # TLS 1.3 only
    ssl_protocols TLSv1.3;
    ssl_ciphers 'TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256';
    ssl_prefer_server_ciphers on;

    # Certificate (Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/carbon6.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/carbon6.yourdomain.com/privkey.pem;

    # HSTS
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    location / {
        proxy_pass http://localhost:3006;
        proxy_set_header X-Forwarded-Proto https;
    }
}
```

---

## ğŸš¨ Security Best Practices

### 1. Change Default Admin Password

**Immediately after installation:**
```bash
# Login to admin dashboard
open http://localhost:3006/admin

# Or via CLI
npx ts-node scripts/change-password.ts --email admin@carbon6.io
```

### 2. Enable Multi-Factor Authentication

**Add TOTP-based 2FA:**
```bash
# Install authenticator app (Google Authenticator, Authy)
# Navigate to: Settings > Security > Enable 2FA
# Scan QR code
# Save backup codes
```

### 3. Restrict SSH Access

**Update SSH keys:**
```bash
# Add public key to GitHub/GitLab
cat ~/.ssh/id_ed25519.pub

# Disable password authentication
sudo nano /etc/ssh/sshd_config
# Set: PasswordAuthentication no
sudo systemctl restart sshd
```

### 4. Database Access Control

**PostgreSQL security:**
```bash
# Connect to PostgreSQL
psql carbon6

# Create read-only user for analytics
CREATE USER analytics_readonly WITH PASSWORD 'secure_password';
GRANT CONNECT ON DATABASE carbon6 TO analytics_readonly;
GRANT USAGE ON SCHEMA public TO analytics_readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO analytics_readonly;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO analytics_readonly;

# Restrict admin user to localhost only
# Edit: /opt/homebrew/var/postgresql@15/pg_hba.conf
# host  carbon6  admin  127.0.0.1/32  scram-sha-256
```

### 5. Rate Limiting Configuration

**Adjust rate limits per installation:**
```bash
# Via Web Terminal
sdk limits <installation-id> --set-hourly 5000

# Or via database
psql carbon6 -c "
  UPDATE connector_installations
  SET rate_limits = '{\"api_calls_per_hour\": 5000}'
  WHERE id = 'inst_xyz123'
"
```

### 6. IP Whitelisting

**Restrict connector access by IP:**
```sql
-- Add IP whitelist to installation
UPDATE connector_installations
SET metadata = jsonb_set(
  COALESCE(metadata, '{}'::jsonb),
  '{allowed_ips}',
  '["192.168.1.0/24", "10.0.0.1"]'::jsonb
)
WHERE id = 'inst_xyz123';
```

**Enforce in middleware:**
```typescript
// src/lib/connector-middleware.ts
if (installation.metadata?.allowed_ips) {
  const clientIp = req.headers.get('x-forwarded-for') || req.ip;
  if (!isIpAllowed(clientIp, installation.metadata.allowed_ips)) {
    return NextResponse.json({ error: 'IP not whitelisted' }, { status: 403 });
  }
}
```

---

## ğŸ” Oracle Validator Security

### Multi-Signature Consensus

**Oracle Validators (Council Tier 1):**
1. **Oracle Strategic** â†’ SOVEREIGN
2. **Oracle Financial** â†’ AURUM
3. **Oracle Legal** â†’ TRUST_DIRECTOR
4. **Oracle Asset/IP** â†’ TRUST_DIRECTOR
5. **Oracle Technology** â†’ TECHNE

**Signature thresholds:**
```
Standard Decisions:    4/5 Oracles (80%)
Emergency Decisions:   3/5 Oracles (60%)
Constitutional:        5/5 Oracles (100%)
```

**Verify Oracle signatures:**
```bash
# Via Web Terminal
oracle verify <decision-id>

# Check signature chain
oracle signatures <decision-id> --verbose
```

---

## ğŸ“‹ Security Checklist

### Daily Operations
- [ ] Review audit logs for failed authentications
- [ ] Check rate limit violations
- [ ] Monitor suspended installations
- [ ] Verify backup completion

### Weekly Maintenance
- [ ] Review active SDK installations
- [ ] Audit creator clearance levels
- [ ] Check for outdated dependencies
- [ ] Review access logs

### Monthly Security Review
- [ ] Rotate JWT secrets
- [ ] Review Oracle validator access
- [ ] Audit L5-BLACK clearance holders
- [ ] Security patch updates
- [ ] Penetration testing (AEGIS-PENETRATOR)

### Quarterly Compliance
- [ ] Full security audit (AEGIS)
- [ ] Compliance verification (TRUST_DIRECTOR)
- [ ] Disaster recovery test
- [ ] Access control review
- [ ] Encryption key rotation assessment

---

## ğŸ†˜ Incident Response

### Security Breach Protocol

**If you suspect a breach:**

```bash
# 1. Immediately suspend all SDK installations
for install_id in $(psql carbon6 -t -c "SELECT id FROM connector_installations WHERE enabled = 1"); do
  curl -X PATCH http://localhost:3006/api/connector/installations/$install_id/suspend \
    -H "Authorization: Bearer $ADMIN_TOKEN" \
    -d '{"reason":"Security incident investigation"}'
done

# 2. Revoke all active tokens
psql carbon6 -c "
  UPDATE connector_tokens
  SET revoked_at = NOW(),
      revocation_reason = 'Security incident'
  WHERE revoked_at IS NULL
"

# 3. Rotate all secrets
./scripts/emergency-rotate-secrets.sh

# 4. Lock admin accounts
psql carbon6 -c "
  UPDATE users
  SET status = 'SUSPENDED'
  WHERE role = 'ADMIN' AND id != 1
"

# 5. Enable verbose audit logging
export SECURITY_AUDIT_LEVEL=verbose
pm2 restart carbon6-api

# 6. Notify AEGIS (Security Guardian)
agent invoke AEGIS --prompt "Security incident detected. Initiate forensic analysis."

# 7. Contact Oracle Validators for emergency consensus
oracle emergency --issue "Security breach detected" --convene-immediately
```

---

## ğŸ“ Security Contacts

**Internal Agents:**
- **AEGIS** (Security Guardian) - Threat monitoring, incident response
- **TRUST_DIRECTOR** (Compliance) - Regulatory, legal issues
- **LOGOS** (Audit) - Forensic logging, evidence preservation

**Emergency Procedures:**
```bash
# Via Web Terminal
@AEGIS Security incident: [describe issue]

# Request emergency Oracle validation
oracle emergency --severity critical

# Initiate lockdown
system lockdown --level maximum
```

---

## ğŸ“ Security Training Resources

**For creators and administrators:**
1. Ed25519 cryptography fundamentals
2. JWT token lifecycle management
3. Connector Protocol best practices
4. Audit log interpretation
5. Incident response procedures

**Run security training:**
```bash
# Via Web Terminal
agent invoke MNEMOS --prompt "Security training for clearance L3-CONFIDENTIAL"
```

---

## ğŸ“– Additional Resources

- **Connector Protocol Spec:** `/docs/CONNECTOR_PROTOCOL.md`
- **Security Architecture:** `/docs/SECURITY_ARCHITECTURE.md`
- **Audit Trail Design:** `/docs/AUDIT_SYSTEM.md`
- **Encryption Standards:** `/docs/ENCRYPTION.md`

---

**Security is not a featureâ€”it's a foundation.**

```
CLASSIFICATION: L5-BLACK Security Protocol
Document ID: L5-SEC-2026-001
Last Updated: February 12, 2026
Authority: AEGIS Security Guardian + TRUST_DIRECTOR
```
